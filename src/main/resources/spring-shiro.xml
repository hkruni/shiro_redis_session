<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<!-- 安全认证过滤器 -->  
    <bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean">  
        <property name="securityManager" ref="securityManager" />  
        <property name="loginUrl" value="/login.jsp" />  
		<property name="successUrl" value="/index.jsp"/> 
   		<property name="unauthorizedUrl" value="/fail.jsp"/>
        <property name="filterChainDefinitions">  
            <value>  
				/css/** = anon
				/js/** =anon
				/login** = anon
				/fail** = anon
                /** = authc
            </value>  
        </property>  
    </bean>  
  
    <!-- 定义 Shiro 主要业务对象 -->  
    <bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager">  
        <property name="realm" ref="systemAuthorizingRealm" />  
		<property name="sessionMode" value="http"></property>    
        <property name="sessionManager" ref="sessionManager"></property>
    </bean>  
	
	<!-- 会话管理器 ，用于Web环境的实现，可以替代ServletContainerSessionManager，自己维护着会话，直接
	 废弃了Servlet容器的会话管理-->
    <bean id="sessionManager" class="org.apache.shiro.web.session.mgt.DefaultWebSessionManager">
    	<!-- 设置全局会话超时时间，默认30分钟(1800000) --> 
        <property name="globalSessionTimeout" value="1800000"/>
		 <!-- 是否在会话过期后会调用SessionDAO的delete方法删除会话 默认true -->
        <property name="deleteInvalidSessions" value="true"/>
		 <!-- 定时检查失效的session -->
        <property name="sessionValidationSchedulerEnabled" value="true"/>
		<!-- 会话验证器调度时间 --> 
        <property name="sessionValidationInterval" value="1800000"/>
		<!-- session存储的实现 -->
        <property name="sessionDAO" ref="redisSession"/>
        <property name="sessionIdCookieEnabled" value="true"/>
		 <!-- sessionIdCookie的实现,用于重写覆盖容器默认的JSESSIONID -->  
        <property name="sessionIdCookie" ref="sessionIdCookie"/>
    </bean>
	
	
	<!-- 保证实现了Shiro内部lifecycle函数的bean执行 -->  
    <bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor" />  
	
	
	
	<!-- 会话ID生成器,org.apache.shiro.web.servlet.SimpleCookie默认已有 -->
    <!--<bean id="sessionIdGenerator" class="org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator"/>-->

    <!-- 会话Cookie模板 -->
    <bean id="sessionIdCookie" class="org.apache.shiro.web.servlet.SimpleCookie">
        <constructor-arg value="sid"/>
		<property name="path" value="/" /> 
        <property name="httpOnly" value="true"/>
        <property name="maxAge" value="180000"/><!--单位是秒-->
    </bean>

</beans>